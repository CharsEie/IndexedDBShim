/*! indexeddbshim - v7.1.0 - 6/15/2021 */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).IDBKeyUtils={})}(this,(function(e){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function t(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==t)return;var n,o,a=[],i=!0,u=!1;try{for(t=t.call(e);!(i=(n=t.next()).done)&&(a.push(n.value),!r||a.length!==r);i=!0);}catch(e){u=!0,o=e}finally{try{i||null==t.return||t.return()}finally{if(u)throw o}}return a}(e,r)||o(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,r){if(e){if("string"==typeof e)return a(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?a(e,r):void 0}}function a(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function i(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=o(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,c=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return u=e.done,e},e:function(e){c=!0,i=e},f:function(){try{u||null==t.return||t.return()}finally{if(c)throw i}}}}var u={},c={};function l(e,r){return new DOMException.prototype.constructor(r,e||"DOMException")}["DEBUG","cacheDatabaseInstances","autoName","fullIDLSupport","checkOrigin","cursorPreloadPackSize","UnicodeIDStart","UnicodeIDContinue","registerSCA","avoidAutoShim","win","DEFAULT_DB_SIZE","useSQLiteIndexes","fs","addNonIDBGlobals","replaceNonIDBGlobals","escapeDatabaseName","unescapeDatabaseName","databaseCharacterEscapeList","databaseNameLengthLimit","escapeNFDForDatabaseNames","addSQLiteExtension",["memoryDatabase",function(e){if(!/^(?::memory:|file::memory:(\?(?:(?!#)[\s\S])*)?(#(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?)?$/.test(e))throw new TypeError('`memoryDatabase` must be the empty string, ":memory:", or a "file::memory:[?queryString][#hash] URL".')}],"deleteDatabaseFiles","databaseBasePath","sysDatabaseBasePath","sqlBusyTimeout","sqlTrace","sqlProfile"].forEach((function(e){var r;if(Array.isArray(e)){var n=t(e,2);e=n[0],r=n[1]}Object.defineProperty(c,e,{get:function(){return u[e]},set:function(t){r&&r(t),u[e]=t}})}));var f={IndexSizeError:1,HierarchyRequestError:3,WrongDocumentError:4,InvalidCharacterError:5,NoModificationAllowedError:7,NotFoundError:8,NotSupportedError:9,InUseAttributeError:10,InvalidStateError:11,SyntaxError:12,InvalidModificationError:13,NamespaceError:14,InvalidAccessError:15,TypeMismatchError:17,SecurityError:18,NetworkError:19,AbortError:20,URLMismatchError:21,QuotaExceededError:22,TimeoutError:23,InvalidNodeTypeError:24,DataCloneError:25,EncodingError:0,NotReadableError:0,UnknownError:0,ConstraintError:0,DataError:0,TransactionInactiveError:0,ReadOnlyError:0,VersionError:0,OperationError:0,NotAllowedError:0},s={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};var y=function(){function e(e,r){this[Symbol.toStringTag]="DOMException",this._code=r in f?f[r]:s[r]||0,this._name=r||"Error",this._message=void 0===e?"":""+e,Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,writable:!0,value:this._code}),void 0!==r&&Object.defineProperty(this,"name",{configurable:!0,enumerable:!0,writable:!0,value:this._name}),void 0!==e&&Object.defineProperty(this,"message",{configurable:!0,enumerable:!1,writable:!0,value:this._message})}var r=function(){};return r.prototype=Object.create(Error.prototype),["name","message"].forEach((function(t){Object.defineProperty(r.prototype,t,{enumerable:!0,get:function(){if(!(this instanceof e||this instanceof r||this instanceof Error))throw new TypeError("Illegal invocation");return this["_"+t]}})})),Object.defineProperty(r.prototype,"code",{configurable:!0,enumerable:!0,get:function(){throw new TypeError("Illegal invocation")}}),e.prototype=new r,e.prototype[Symbol.toStringTag]="DOMExceptionPrototype",Object.defineProperty(e,"prototype",{writable:!1}),Object.keys(f).forEach((function(r){Object.defineProperty(e.prototype,r,{enumerable:!0,configurable:!1,value:f[r]}),Object.defineProperty(e,r,{enumerable:!0,configurable:!1,value:f[r]})})),Object.keys(s).forEach((function(r){Object.defineProperty(e.prototype,r,{enumerable:!0,configurable:!1,value:s[r]}),Object.defineProperty(e,r,{enumerable:!0,configurable:!1,value:s[r]})})),Object.defineProperty(e.prototype,"constructor",{writable:!0,configurable:!0,enumerable:!1,value:e}),e}();function d(e,r,t){if(c.DEBUG){t&&t.message&&(t=t.message);var n="function"==typeof console.error?"error":"log";console[n](e+": "+r+". "+(t||"")),console.trace&&console.trace()}}var p,v,b=!1;try{p=l("test name","test message"),(v=p)&&"object"===r(v)&&"string"==typeof v.name&&"test name"===p.name&&"test message"===p.message&&(b=!0)}catch(e){}var m=b?function(e,r,t){return d(e,r,t),l(e,r)}:function(e,r,t){return d(e,r,t),function(e,r){return new y(r,e)}(e,r)};function E(e){return function(e){return e.replace(/((?:[\uD800-\uDBFF](?![\uDC00-\uDFFF])))(?!(?:(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]))|(^|(?:(?![\uD800-\uDBFF](?![\uDC00-\uDFFF]))[\s\S]))((?:(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]))/g,(function(e,r,t,n){return r?"^2"+r.charCodeAt().toString(16).padStart(4,"0"):(t||"")+"^3"+n.charCodeAt().toString(16).padStart(4,"0")}))}(e.replace(/\^/g,"^^").replace(/\0/g,"^0"))}function h(e){return e&&"object"===r(e)}function g(e){return null==e}function D(e,t){var n=k(e),o=k(t),a=n>o?1:n===o?0:-1;if(c.DEBUG){var i=G(n),u=G(o);"object"===r(e)&&(e=JSON.stringify(e),i=JSON.stringify(i)),"object"===r(t)&&(t=JSON.stringify(t),u=JSON.stringify(u)),i!==e&&console.warn(e+" was incorrectly encoded as "+i),u!==t&&console.warn(t+" was incorrectly encoded as "+u)}return a}var F={invalid:100,number:200,date:300,string:400,binary:500,array:600},N=Object.keys(F);N.forEach((function(e){F[e]=String.fromCharCode(F[e])}));var I=N.reduce((function(e,r){return e[F[r]]=r,e}),{}),O=["negativeInfinity","bigNegative","smallNegative","smallPositive","bigPositive","positiveInfinity"],_={invalid:{encode:function(e){return F.invalid+"-"},decode:function(e){}},number:{encode:function(e){var r,t,n,o=e===Number.MIN_VALUE?"0."+"0".repeat(214)+"2":Math.abs(e).toString(32),a=o.indexOf("."),i=(o=-1!==a?o.replace(".",""):o).search(/(?:(?!0)[\s\S])/);return o=o.slice(i),Number.isFinite(Number(e))?e<0?e>-1?(r=O.indexOf("smallNegative"),t=w(i),n=S(A(o))):(r=O.indexOf("bigNegative"),t=S(w(-1!==a?a:o.length)),n=S(A(o))):e<1?(r=O.indexOf("smallPositive"),t=S(w(i)),n=A(o)):(r=O.indexOf("bigPositive"),t=w(-1!==a?a:o.length),n=A(o)):(t=C(2),n=C(11),r=O.indexOf(e>0?"positiveInfinity":"negativeInfinity")),F.number+"-"+r+t+n},decode:function(e){var r=Number(e.slice(2,3)),t=e.slice(3,5),n=e.slice(5,16);switch(O[r]){case"negativeInfinity":return Number.NEGATIVE_INFINITY;case"positiveInfinity":return Number.POSITIVE_INFINITY;case"bigPositive":return R(n,t);case"smallPositive":return R(n,t=P(S(t)));case"smallNegative":return t=P(t),-R(n=S(n),t);case"bigNegative":return t=S(t),-R(n=S(n),t);default:throw new Error("Invalid number.")}}},string:{encode:function(e,r){return r&&(e=e.replace(/((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]))/g,"-$1")+" "),F.string+"-"+e},decode:function(e,r){return e=e.slice(2),r&&(e=e.slice(0,-1).replace(/\x2D((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]))/g,"$1")),e}},array:{encode:function(e){var r,n=[],o=i(e.entries());try{for(o.s();!(r=o.n()).done;){var a=t(r.value,2),u=a[0],c=k(a[1],!0);n[u]=c}}catch(e){o.e(e)}finally{o.f()}return n.push(F.invalid+"-"),F.array+"-"+JSON.stringify(n)},decode:function(e){var r=JSON.parse(e.slice(2));r.pop();for(var t=0;t<r.length;t++){var n=G(r[t],!0);r[t]=n}return r}},date:{encode:function(e){return F.date+"-"+e.toJSON()},decode:function(e){return new Date(e.slice(2))}},binary:{encode:function(e){return F.binary+"-"+(e.byteLength?n(j(e)).map((function(e){return String(e).padStart(3,"0")})):"")},decode:function(e){var r=e.slice(2),t=r.length?r.split(",").map((function(e){return Number.parseInt(e)})):[],n=new ArrayBuffer(t.length);return new Uint8Array(n).set(t),n}}};function w(e){return 1===(e=e.toString(32)).length?"0"+e:e}function A(e){return(e+C(11)).slice(0,11)}function S(e){var r,t="",n=i(e);try{for(n.s();!(r=n.n()).done;){var o=r.value;t+=(31-Number.parseInt(o,32)).toString(32)}}catch(e){n.e(e)}finally{n.f()}return t}function R(e,r){if((r=Number.parseInt(r,32))<0)return T(Number.parseInt(e,32)*Math.pow(32,r-10));if(r<11){var t=e.slice(0,r);t=Number.parseInt(t,32);var n=e.slice(r);return T(t+(n=Number.parseInt(n,32)*Math.pow(32,r-11)))}var o=e+C(r-11);return Number.parseInt(o,32)}function T(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16;return Number.parseFloat(e.toPrecision(r))}function C(e){return"0".repeat(e)}function P(e){return"-"+e}function M(e){if(Array.isArray(e))return"array";if(function(e){return h(e)&&"function"==typeof e.getDate}(e))return"date";if(function(e){return h(e)&&"number"==typeof e.byteLength&&("function"==typeof e.slice||"function"==typeof e.getFloat64)}(e))return"binary";var t=r(e);return["string","number"].includes(t)?t:"invalid"}function B(e,r){return x(e,r,!1,!0)}function j(e){var r=0,t=0;if(ArrayBuffer.isView(e)){if(void 0===e.buffer)throw new TypeError("Could not copy the bytes held by a buffer source as the buffer was undefined.");r=e.byteOffset,t=e.byteLength}else t=e.byteLength;return new Uint8Array(e.buffer||e,r,t)}function x(e,t,n,o){if((t=t||[]).includes(e))return{type:"array",invalid:!0,message:"An array key cannot be circular"};var a=M(e),i={type:a,value:e};switch(a){case"number":return Number.isNaN(e)?{type:"NaN",invalid:!0}:i;case"string":return i;case"binary":return{type:"binary",value:j(e)};case"array":var u=e.length;t.push(e);for(var c=[],l=0;l<u;l++){if(!n&&!Object.prototype.hasOwnProperty.call(e,l))return{type:a,invalid:!0,message:"Does not have own index property"};try{var f=function(){var r=x(e[l],t,!1,o);if(r.invalid)return n?"continue":{v:{type:a,invalid:!0,message:"Bad array entry value-to-key conversion"}};(!n||!o&&c.every((function(e){return 0!==D(e,r.value)}))||o&&c.every((function(e){return 0!==D(e,r)})))&&c.push(o?r:r.value)}();if("continue"===f)continue;if("object"===r(f))return f.v}catch(e){if(!n)throw e}}return{type:a,value:c};case"date":return Number.isNaN(e.getTime())?{type:a,invalid:!0,message:"Not a valid date"}:o?{type:a,value:e.getTime()}:{type:a,value:new Date(e.getTime())};case"invalid":default:var s=null===e?"null":r(e);return{type:s,invalid:!0,message:"Not a valid key; type "+s}}}function U(e,r){return x(e,null,!0,r)}function L(e,r,t,n){var o=V(e,r);return o.failure?o:t?U(o.value,n):x(o.value,null,!1,n)}function V(e,r,t,n){if(Array.isArray(r)){var o=[];return r.some((function(r){var t=V(e,r);return!!t.failure||(o.push(t.value),!1)}))?{failure:!0}:{value:o}}return""===r?{value:e}:r.split(".").some((function(r,t){if("length"!==r||"string"!=typeof e&&!Array.isArray(e))if(function(e){return h(e)&&"number"==typeof e.size&&"function"==typeof e.slice&&!("lastModified"in e)}(e))switch(r){case"size":case"type":e=e[r]}else{if(!function(e){return h(e)&&"string"==typeof e.name&&"function"==typeof e.slice&&"lastModified"in e}(e))return!h(e)||!Object.prototype.hasOwnProperty.call(e,r)||void 0===(e=e[r]);switch(r){case"name":case"lastModified":e=e[r];break;case"lastModifiedDate":e=new Date(e.lastModified)}}else e=e.length;return!1}))?{failure:!0}:{value:e}}function K(e,r,t){var n=void 0===r.lower,o=void 0===r.upper,a=k(e,!0),i=t?r.__lowerCached:k(r.lower,!0),u=t?r.__upperCached:k(r.upper,!0);return void 0!==r.lower&&(r.lowerOpen&&a>i&&(n=!0),!r.lowerOpen&&a>=i&&(n=!0)),void 0!==r.upper&&(r.upperOpen&&a<u&&(o=!0),!r.upperOpen&&a<=u&&(o=!0)),n&&o}function k(e,r){return void 0===e?null:_[M(e)].encode(e,r)}function G(e,r){if("string"==typeof e)return _[I[e.slice(0,1)]].decode(e,r)}var H=9007199254740992;function q(e,r,t,n){e.executeSql('SELECT "currNum" FROM __sys__ WHERE "name" = ?',[E(r.__currentName)],(function(e,r){1!==r.rows.length?t(1):t(r.rows.item(0).currNum)}),(function(e,r){n(m("DataError","Could not get the auto increment value for key",r))}))}function J(e,r,t,n,o){var a='UPDATE __sys__ SET "currNum" = ? WHERE "name" = ?',i=[t,E(r.__currentName)];c.DEBUG&&console.log(a,i),e.executeSql(a,i,(function(e,r){n(t)}),(function(e,r){o(m("UnknownError","Could not set the auto increment value for key",r))}))}function W(e,r,t,n,o){return J(e,r,t=t===H?t+2:t+1,n,o)}e.assignCurrentNumber=J,e.checkKeyCouldBeInjectedIntoValue=function(e,r){var t=r.split(".");t.pop();var n,o=i(t);try{for(o.s();!(n=o.n()).done;){var a=n.value;if(!h(e))return!1;if(!Object.prototype.hasOwnProperty.call(e,a))return!0;e=e[a]}}catch(e){o.e(e)}finally{o.f()}return h(e)},e.convertKeyToValue=function e(r){var t=r.type,n=r.value;switch(t){case"number":case"string":return n;case"array":for(var o=[],a=n.length,i=0;i<a;){var u=e(n[i]);o[i]=u,i++}return o;case"date":return new Date(n);case"binary":var c=n.length,l=new ArrayBuffer(c);return new Uint8Array(l,n.byteOffset||0,n.byteLength).set(n),l;case"invalid":default:throw new Error("Bad key")}},e.convertValueToKey=B,e.convertValueToKeyRethrowingAndIfInvalid=function(e,r){var t=B(e,r);if(t.invalid)throw m("DataError",t.message||"Not a valid key; type: "+t.type);return t},e.convertValueToKeyValueDecoded=x,e.convertValueToMultiEntryKey=function(e){return x(e,null,!0,!0)},e.convertValueToMultiEntryKeyDecoded=U,e.decode=G,e.encode=k,e.evaluateKeyPathOnValue=function(e,r,t){return V(e,r)},e.extractKeyFromValueUsingKeyPath=function(e,r,t){return L(e,r,t,!0)},e.extractKeyValueDecodedFromValueUsingKeyPath=L,e.findMultiEntryMatches=function e(r,t){var n=[];if(Array.isArray(r)){var o,a=i(r);try{for(a.s();!(o=a.n()).done;){var u=o.value;if(Array.isArray(u)){if(t&&t.lower===t.upper)continue;if(1!==u.length){e(u,t).length>0&&n.push(u);continue}u=u[0]}(g(t)||K(u,t,!0))&&n.push(u)}}catch(e){a.e(e)}finally{a.f()}}else(g(t)||K(r,t,!0))&&n.push(r);return n},e.generateKeyForStore=function(e,r,t,n){q(e,r,(function(o){o>H?t("failure"):W(e,r,o,(function(){t(null,o,o)}),n)}),n)},e.injectKeyIntoValueUsingKeyPath=function(e,r,t){var n=t.split("."),o=n.pop();n.forEach((function(r){Object.prototype.hasOwnProperty.call(e,r)||(e[r]={}),e=e[r]})),e[o]=r},e.isKeyInRange=K,e.isMultiEntryMatch=function(e,r){return"array"===I[r.slice(0,1)]?r.indexOf(e)>1:r===e},e.possiblyUpdateKeyGenerator=function(e,r,t,n,o){"number"!=typeof t||t<1?n():q(e,r,(function(a){var i=Math.floor(Math.min(t,H));i>=a?W(e,r,i,(function(){n(a)}),o):n()}),o)},e.roundTrip=function(e,r){return G(k(e,r),r)},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=indexeddbshim-Key.min.js.map
