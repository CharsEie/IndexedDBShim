{"version":3,"sources":["../src/globalVars.js"],"names":[],"mappings":"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","file":"indexeddbshim.js","sourcesContent":["/*global GLOBAL*/\r\nimport {shimIDBVersionChangeEvent} from './Event.js';\r\nimport shimIDBKeyRange from './IDBKeyRange.js';\r\nimport {shimIDBCursor, shimIDBCursorWithValue} from './IDBCursor.js';\r\nimport shimIDBObjectStore from './IDBObjectStore.js';\r\nimport shimIDBIndex from './IDBIndex.js';\r\nimport shimIDBTransaction from './IDBTransaction.js';\r\nimport shimIDBDatabase from './IDBDatabase.js';\r\nimport {shimIDBRequest, shimIDBOpenDBRequest} from './IDBRequest.js';\r\nimport {shimIDBFactory, shimIndexedDB} from './IDBFactory.js';\r\nimport polyfill from './polyfill.js';\r\n\r\n(function () {\r\n    'use strict';\r\n    const global = typeof window !== 'undefined' ? window : GLOBAL; // DEBUG, cursorPreloadPackSize=100\r\n\r\n    function shim(name, value) {\r\n        try {\r\n            // Try setting the property. This will fail if the property is read-only.\r\n            window[name] = value;\r\n        }\r\n        catch (e) {}\r\n\r\n        if (window[name] !== value && Object.defineProperty) {\r\n            // Setting a read-only property failed, so try re-defining the property\r\n            try {\r\n                Object.defineProperty(window, name, {\r\n                    value: value\r\n                });\r\n            }\r\n            catch (e) {}\r\n\r\n            if (window[name] !== value) {\r\n                window.console && console.warn && console.warn('Unable to shim ' + name);\r\n            }\r\n        }\r\n    }\r\n\r\n    shim('shimIndexedDB', shimIndexedDB);\r\n    if (window.shimIndexedDB) {\r\n        window.shimIndexedDB.__useShim = function(){\r\n            if (typeof window.openDatabase !== \"undefined\") {\r\n                // Polyfill ALL of IndexedDB, using WebSQL\r\n                shim('indexedDB', shimIndexedDB);\r\n                shim('IDBFactory', shimIDBFactory);\r\n                shim('IDBDatabase', shimIDBDatabase);\r\n                shim('IDBObjectStore', shimIDBObjectStore);\r\n                shim('IDBIndex', shimIDBIndex);\r\n                shim('IDBTransaction', shimIDBTransaction);\r\n                shim('IDBCursor', shimIDBCursor);\r\n                shim('IDBKeyRange', shimIDBKeyRange);\r\n                shim('IDBRequest', shimIDBRequest);\r\n                shim('IDBOpenDBRequest', shimIDBOpenDBRequest);\r\n                shim('IDBVersionChangeEvent', shimIDBVersionChangeEvent);\r\n            }\r\n            else if (typeof window.indexedDB === \"object\") {\r\n                // Polyfill the missing IndexedDB features (no need for IDBEnvironment (window containing indexedDB itself))\r\n                polyfill(shimIDBCursor, shimIDBCursorWithValue, shimIDBDatabase, shimIDBFactory, shimIDBIndex, shimIDBKeyRange, shimIDBObjectStore, shimIDBRequest, shimIDBTransaction);\r\n            }\r\n        };\r\n\r\n        window.shimIndexedDB.__debug = function(val){\r\n            global.DEBUG = val;\r\n        };\r\n    }\r\n\r\n    // Workaround to prevent an error in Firefox\r\n    if(!('indexedDB' in window)) {\r\n        window.indexedDB = window.indexedDB || window.webkitIndexedDB || window.mozIndexedDB || window.oIndexedDB || window.msIndexedDB;\r\n    }\r\n\r\n    // Detect browsers with known IndexedDb issues (e.g. Android pre-4.4)\r\n    let poorIndexedDbSupport = false;\r\n    if (navigator.userAgent.match(/Android 2/) || navigator.userAgent.match(/Android 3/) || navigator.userAgent.match(/Android 4\\.[0-3]/)) {\r\n        /* Chrome is an exception. It supports IndexedDb */\r\n        if (!navigator.userAgent.match(/Chrome/)) {\r\n            poorIndexedDbSupport = true;\r\n        }\r\n    }\r\n\r\n    if ((typeof window.indexedDB === \"undefined\" || !window.indexedDB || poorIndexedDbSupport) && typeof window.openDatabase !== \"undefined\") {\r\n        window.shimIndexedDB.__useShim();\r\n    }\r\n    else {\r\n        window.IDBDatabase = window.IDBDatabase || window.webkitIDBDatabase;\r\n        window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction;\r\n        window.IDBCursor = window.IDBCursor || window.webkitIDBCursor;\r\n        window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange;\r\n        if(!window.IDBTransaction){\r\n            window.IDBTransaction = {};\r\n        }\r\n        /* Some browsers (e.g. Chrome 18 on Android) support IndexedDb but do not allow writing of these properties */\r\n        try {\r\n            window.IDBTransaction.READ_ONLY = window.IDBTransaction.READ_ONLY || \"readonly\";\r\n            window.IDBTransaction.READ_WRITE = window.IDBTransaction.READ_WRITE || \"readwrite\";\r\n        } catch (e) {}\r\n    }\r\n}());\r\n"]}